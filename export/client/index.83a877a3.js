import{S as e,i as t,s as a,e as r,b as s,c as l,g as c,h as i,j as n,f as o,k as f,l as u,I as v,o as h,p as g,P as p,H as d,n as m,Q as $,R as b,w as E,a as I,u as C,t as D,r as V,v as w,m as y,d as k,K as x,N}from"./client.9ee6942c.js";import{p as j,d as A,g as L}from"./api.c8188bb8.js";function O(e,t,a){const r=Object.create(e);return r.tag=t[a],r}function S(e){var t,a,d,m,$,b,E,I=e.article.favoritesCount?"Убрать из списка":"Добавить в список";return{c(){t=r("div"),a=r("button"),d=r("i"),m=s(),$=l(I),this.h()},l(e){t=c(e,"DIV",{class:!0},!1);var r=i(t);a=c(r,"BUTTON",{class:!0},!1);var s=i(a);d=c(s,"I",{class:!0},!1),i(d).forEach(n),m=o(s),$=f(s,I),s.forEach(n),r.forEach(n),this.h()},h(){u(d,"class","ion-plus-round"),u(a,"class",b="btn btn-sm "+(e.article.favorited?"btn-primary":"btn-outline-primary")+" svelte-fubfs"),u(t,"class","pull-xs-right"),E=v(a,"click",e.toggleFavorite)},m(e,r){h(e,t,r),g(t,a),g(a,d),g(a,m),g(a,$)},p(e,t){e.article&&I!==(I=t.article.favoritesCount?"Убрать из списка":"Добавить в список")&&p($,I),e.article&&b!==(b="btn btn-sm "+(t.article.favorited?"btn-primary":"btn-outline-primary")+" svelte-fubfs")&&u(a,"class",b)},d(e){e&&n(t),E()}}}function q(e){var t,a,v,d=e.tag+"";return{c(){t=r("li"),a=l(d),v=s(),this.h()},l(e){t=c(e,"LI",{class:!0},!1);var r=i(t);a=f(r,d),v=o(r),r.forEach(n),this.h()},h(){u(t,"class","tag-default tag-pill tag-outline")},m(e,r){h(e,t,r),g(t,a),g(t,v)},p(e,t){e.article&&d!==(d=t.tag+"")&&p(a,d)},d(e){e&&n(t)}}}function P(e){var t,a,v,b,E,I,C,D,V,w,y,k,x,N,j,A,L,P,U,F,H,M,R,T,B,K=new Date(e.article.createdAt).toDateString()+"",Q=e.article.title+"",z=e.article.description+"",G=e.user&&S(e);let J=e.article.tagList,W=[];for(let t=0;t<J.length;t+=1)W[t]=q(O(e,J,t));return{c(){t=r("div"),a=r("div"),v=r("div"),b=r("span"),E=l(K),I=s(),G&&G.c(),C=s(),D=r("a"),V=r("div"),w=r("div"),y=r("div"),k=r("div"),x=s(),N=r("div"),j=r("div"),A=r("div"),L=r("h2"),P=l(Q),U=s(),F=r("div");for(let e=0;e<W.length;e+=1)W[e].c();H=s(),M=r("div"),R=r("p"),T=l(z),this.h()},l(e){t=c(e,"DIV",{class:!0},!1);var r=i(t);a=c(r,"DIV",{class:!0},!1);var s=i(a);v=c(s,"DIV",{class:!0},!1);var l=i(v);b=c(l,"SPAN",{class:!0},!1);var u=i(b);E=f(u,K),u.forEach(n),l.forEach(n),I=o(s),G&&G.l(s),s.forEach(n),C=o(r),D=c(r,"A",{href:!0,rel:!0,class:!0},!1);var h=i(D);V=c(h,"DIV",{class:!0},!1);var g=i(V);w=c(g,"DIV",{class:!0},!1);var p=i(w);y=c(p,"DIV",{class:!0},!1);var d=i(y);k=c(d,"DIV",{class:!0},!1),i(k).forEach(n),d.forEach(n),x=o(p),N=c(p,"DIV",{class:!0},!1);var m=i(N);j=c(m,"DIV",{class:!0},!1);var $=i(j);A=c($,"DIV",{class:!0,style:!0},!1);var O=i(A);L=c(O,"H2",{class:!0},!1);var S=i(L);P=f(S,Q),S.forEach(n),U=o(O),F=c(O,"DIV",{class:!0},!1);var q=i(F);for(let e=0;e<W.length;e+=1)W[e].l(q);q.forEach(n),O.forEach(n),H=o($),M=c($,"DIV",{class:!0},!1);var B=i(M);R=c(B,"P",{class:!0},!1);var J=i(R);T=f(J,z),J.forEach(n),B.forEach(n),$.forEach(n),m.forEach(n),p.forEach(n),g.forEach(n),h.forEach(n),r.forEach(n),this.h()},h(){u(b,"class","date"),u(v,"class","info"),u(a,"class","article-meta"),u(k,"class","five svelte-fubfs"),u(y,"class","ten svelte-fubfs"),u(L,"class","svelte-fubfs"),u(F,"class","teg svelte-fubfs"),u(A,"class","seven svelte-fubfs"),d(A,"text-align","center"),u(R,"class","leading-normal text-left slide-in-bottom-subtitle"),u(M,"class","nine svelte-fubfs"),u(j,"class","four svelte-fubfs"),u(N,"class","ten svelte-fubfs"),u(w,"class","three container svelte-fubfs"),u(V,"class","six svelte-fubfs"),u(D,"href",B="/article/"+e.article.slug),u(D,"rel","prefetch"),u(D,"class","preview-link"),u(t,"class","article-preview")},m(e,r){h(e,t,r),g(t,a),g(a,v),g(v,b),g(b,E),g(a,I),G&&G.m(a,null),g(t,C),g(t,D),g(D,V),g(V,w),g(w,y),g(y,k),g(w,x),g(w,N),g(N,j),g(j,A),g(A,L),g(L,P),g(A,U),g(A,F);for(let e=0;e<W.length;e+=1)W[e].m(F,null);g(j,H),g(j,M),g(M,R),g(R,T)},p(e,t){if(e.article&&K!==(K=new Date(t.article.createdAt).toDateString()+"")&&p(E,K),t.user?G?G.p(e,t):((G=S(t)).c(),G.m(a,null)):G&&(G.d(1),G=null),e.article&&Q!==(Q=t.article.title+"")&&p(P,Q),e.article){let a;for(J=t.article.tagList,a=0;a<J.length;a+=1){const r=O(t,J,a);W[a]?W[a].p(e,r):(W[a]=q(r),W[a].c(),W[a].m(F,null))}for(;a<W.length;a+=1)W[a].d(1);W.length=J.length}e.article&&z!==(z=t.article.description+"")&&p(T,z),e.article&&B!==(B="/article/"+t.article.slug)&&u(D,"href",B)},i:m,o:m,d(e){e&&n(t),G&&G.d(),$(W,e)}}}function U(e,t,a){let{article:r,user:s}=t;return e.$set=e=>{"article"in e&&a("article",r=e.article),"user"in e&&a("user",s=e.user)},{article:r,user:s,toggleFavorite:async function(){r.favorited?(a("article",r.favoritesCount-=1,r),a("article",r.favorited=!1,r)):(a("article",r.favoritesCount+=1,r),a("article",r.favorited=!0,r)),a("article",({article:r}=await(r.favorited?j(`articles/${r.slug}/favorite`,null,s&&s.token):A(`articles/${r.slug}/favorite`,s&&s.token))),r)}}}class F extends e{constructor(e){super(),t(this,e,U,P,a,["article","user"])}}function H(e,t,a){const r=Object.create(e);return r.v=t[a],r}function M(e){var t,a;let s=e.range,l=[];for(let t=0;t<s.length;t+=1)l[t]=R(H(e,s,t));return{c(){t=r("nav"),a=r("ul");for(let e=0;e<l.length;e+=1)l[e].c();this.h()},l(e){t=c(e,"NAV",{},!1);var r=i(t);a=c(r,"UL",{class:!0},!1);var s=i(a);for(let e=0;e<l.length;e+=1)l[e].l(s);s.forEach(n),r.forEach(n),this.h()},h(){u(a,"class","pagination")},m(e,r){h(e,t,r),g(t,a);for(let e=0;e<l.length;e+=1)l[e].m(a,null)},p(e,t){if(e.range||e.page){let r;for(s=t.range,r=0;r<s.length;r+=1){const c=H(t,s,r);l[r]?l[r].p(e,c):(l[r]=R(c),l[r].c(),l[r].m(a,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=s.length}},d(e){e&&n(t),$(l,e)}}}function R(e){var t,a,v,d,m,$,b=e.v+1+"";return{c(){t=r("li"),a=r("a"),v=l(b),m=s(),this.h()},l(e){t=c(e,"LI",{class:!0},!1);var r=i(t);a=c(r,"A",{class:!0,href:!0},!1);var s=i(a);v=f(s,b),s.forEach(n),m=o(r),r.forEach(n),this.h()},h(){u(a,"class","page-link"),u(a,"href",d="/"+(e.v?e.v+1:"")),u(t,"class",$="page-item "+(e.v===e.page?"active":""))},m(e,r){h(e,t,r),g(t,a),g(a,v),g(t,m)},p(e,r){e.range&&b!==(b=r.v+1+"")&&p(v,b),e.range&&d!==(d="/"+(r.v?r.v+1:""))&&u(a,"href",d),(e.range||e.page)&&$!==($="page-item "+(r.v===r.page?"active":""))&&u(t,"class",$)},d(e){e&&n(t)}}}function T(e){var t,a=e.articlesCount>10&&M(e);return{c(){a&&a.c(),t=b()},l(e){a&&a.l(e),t=b()},m(e,r){a&&a.m(e,r),h(e,t,r)},p(e,r){r.articlesCount>10?a?a.p(e,r):((a=M(r)).c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null)},i:m,o:m,d(e){a&&a.d(e),e&&n(t)}}}function B(e,t,a){let r,{articlesCount:s,page:l}=t;return e.$set=e=>{"articlesCount"in e&&a("articlesCount",s=e.articlesCount),"page"in e&&a("page",l=e.page)},e.$$.update=(e={articlesCount:1,range:1})=>{if(e.articlesCount||e.range){a("range",r=[]);for(let e=0;e<Math.ceil(s/10);++e)r.push(e)}},{articlesCount:s,page:l,range:r}}class K extends e{constructor(e){super(),t(this,e,B,T,a,["articlesCount","page"])}}function Q(e,t,a){const r=Object.create(e);return r.article=t[a],r}function z(e){var t,a;return{c(){t=r("div"),a=l("Загрузка..."),this.h()},l(e){t=c(e,"DIV",{class:!0},!1);var r=i(t);a=f(r,"Загрузка..."),r.forEach(n),this.h()},h(){u(t,"class","article-preview")},m(e,r){h(e,t,r),g(t,a)},p:m,i:m,o:m,d(e){e&&n(t)}}}function G(e){var t,a,r,s,l=[W,J],c=[];function i(e,t){return 0===t.articles.length?0:1}return t=i(0,e),a=c[t]=l[t](e),{c(){a.c(),r=b()},l(e){a.l(e),r=b()},m(e,a){c[t].m(e,a),h(e,r,a),s=!0},p(e,s){var n=t;(t=i(0,s))===n?c[t].p(e,s):(E(),I(c[n],1,1,()=>{c[n]=null}),C(),(a=c[t])||(a=c[t]=l[t](s)).c(),D(a,1),a.m(r.parentNode,r))},i(e){s||(D(a),s=!0)},o(e){I(a),s=!1},d(e){c[t].d(e),e&&n(r)}}}function J(e){var t,a,l,f=[],u=new Map;let v=e.articles;const p=e=>e.article.slug;for(let t=0;t<v.length;t+=1){let a=Q(e,v,t),r=p(a);u.set(r,f[t]=X(r,a))}var d=new K({props:{articlesCount:e.articlesCount,page:parseInt(e.$page.params.user,10)}});return{c(){t=r("div");for(let e=0;e<f.length;e+=1)f[e].c();a=s(),d.$$.fragment.c()},l(e){t=c(e,"DIV",{},!1);var r=i(t);for(let e=0;e<f.length;e+=1)f[e].l(r);a=o(r),d.$$.fragment.l(r),r.forEach(n)},m(e,r){h(e,t,r);for(let e=0;e<f.length;e+=1)f[e].m(t,null);g(t,a),y(d,t,null),l=!0},p(e,r){const s=r.articles;E(),f=x(f,e,p,1,r,s,u,t,N,X,a,Q),C();var l={};e.articlesCount&&(l.articlesCount=r.articlesCount),e.$page&&(l.page=parseInt(r.$page.params.user,10)),d.$set(l)},i(e){if(!l){for(let e=0;e<v.length;e+=1)D(f[e]);D(d.$$.fragment,e),l=!0}},o(e){for(let e=0;e<f.length;e+=1)I(f[e]);I(d.$$.fragment,e),l=!1},d(e){e&&n(t);for(let e=0;e<f.length;e+=1)f[e].d();k(d)}}}function W(e){var t,a;return{c(){t=r("div"),a=l("Тут ничего нет."),this.h()},l(e){t=c(e,"DIV",{class:!0},!1);var r=i(t);a=f(r,"Тут ничего нет."),r.forEach(n),this.h()},h(){u(t,"class","article-preview")},m(e,r){h(e,t,r),g(t,a)},p:m,i:m,o:m,d(e){e&&n(t)}}}function X(e,t){var a,r,s=new F({props:{article:t.article,user:t.$session.user}});return{key:e,first:null,c(){a=b(),s.$$.fragment.c(),this.h()},l(e){a=b(),s.$$.fragment.l(e),this.h()},h(){this.first=a},m(e,t){h(e,a,t),y(s,e,t),r=!0},p(e,t){var a={};e.articles&&(a.article=t.article),e.$session&&(a.user=t.$session.user),s.$set(a)},i(e){r||(D(s.$$.fragment,e),r=!0)},o(e){I(s.$$.fragment,e),r=!1},d(e){e&&n(a),k(s,e)}}}function Y(e){var t,a,r,s,l=[G,z],c=[];function i(e,t){return t.articles?0:1}return t=i(0,e),a=c[t]=l[t](e),{c(){a.c(),r=b()},l(e){a.l(e),r=b()},m(e,a){c[t].m(e,a),h(e,r,a),s=!0},p(e,s){var n=t;(t=i(0,s))===n?c[t].p(e,s):(E(),I(c[n],1,1,()=>{c[n]=null}),C(),(a=c[t])||(a=c[t]=l[t](s)).c(),D(a,1),a.m(r.parentNode,r))},i(e){s||(D(a),s=!0)},o(e){I(a),s=!1},d(e){c[t].d(e),e&&n(r)}}}function Z(e,t,a){let r,s,{tab:l,username:c=!1,favorites:i=!1,tag:n,p:o}=t;const{session:f,page:u}=V();let v,h,g;return w(e,f,e=>{a("$session",r=e)}),w(e,u,e=>{a("$page",s=e)}),e.$set=e=>{"tab"in e&&a("tab",l=e.tab),"username"in e&&a("username",c=e.username),"favorites"in e&&a("favorites",i=e.favorites),"tag"in e&&a("tag",n=e.tag),"p"in e&&a("p",o=e.p)},e.$$.update=(e={tab:1,p:1,tag:1,favorites:1,username:1,query:1})=>{if(e.tab||e.p||e.tag||e.favorites||e.username){const e="feed"===l?"articles/feed":"articles",t="feed"===l?5:10;let r=`limit=${t}&offset=${(o-1)*t}`;"tag"===l&&(r+=`&tag=${n}`),"profile"===l&&(r+=`&${i?"favorited":"author"}=${encodeURIComponent(c)}`),a("query",v=`${e}?${r}`)}e.query&&v&&async function(){a("articles",h=null),a("articles",({articles:h,articlesCount:g}=await L(v,r.user&&r.user.token)),h,a("articlesCount",g))}()},{tab:l,username:c,favorites:i,tag:n,p:o,session:f,page:u,articles:h,articlesCount:g,$session:r,$page:s}}class _ extends e{constructor(e){super(),t(this,e,Z,Y,a,["tab","username","favorites","tag","p"])}}export{_ as I};
