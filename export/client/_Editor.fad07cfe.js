import{S as t,i as a,s,e,b as r,c as l,g as i,h as c,j as o,f as n,k as u,l as f,C as p,o as d,p as h,D as g,m as v,R as m,t as E,a as $,d as y,F as b,T as L,r as T,v as I,W as _}from"./client.0b5a1f8a.js";import{a as P,p as k}from"./api.c8188bb8.js";import{N as D,s as x}from"./Notifications.a2382462.js";import{L as w}from"./ListErrors.9ee4e1ce.js";function F(t,a,s){const e=Object.create(t);return e.tag=a[s],e.i=s,e}function N(t){var a,s,v,m,E,$,y=t.tag+"";function b(){return t.click_handler(t)}return{c(){a=e("span"),s=e("i"),v=r(),m=l(y),E=r(),this.h()},l(t){a=i(t,"SPAN",{class:!0},!1);var e=c(a);s=i(e,"I",{class:!0},!1),c(s).forEach(o),v=n(e),m=u(e,y),E=n(e),e.forEach(o),this.h()},h(){f(s,"class","ion-close-round"),f(a,"class","tag-default tag-pill"),$=p(s,"click",b)},m(t,e){d(t,a,e),h(a,s),h(a,v),h(a,m),h(a,E)},p(a,s){t=s,a.article&&y!==(y=t.tag+"")&&g(m,y)},d(t){t&&o(a),$()}}}function S(t){var a,s,g,T,I,_,P,k,x,S,j,V,U,A,O,R,B,C,M,W,X,q,z,G,H,J,K,Q=new w({props:{errors:t.errors}});let Y=t.article.tagList,Z=[];for(let a=0;a<Y.length;a+=1)Z[a]=N(F(t,Y,a));var tt=new D({});return{c(){a=e("div"),s=e("div"),g=e("div"),T=e("div"),Q.$$.fragment.c(),I=r(),_=e("form"),P=e("fieldset"),k=e("fieldset"),x=e("input"),S=r(),j=e("fieldset"),V=e("input"),U=r(),A=e("fieldset"),O=e("textarea"),R=r(),B=e("fieldset"),C=e("input"),W=r(),X=e("div");for(let t=0;t<Z.length;t+=1)Z[t].c();q=r(),z=e("button"),G=l("Опубликовать литературу"),H=r(),tt.$$.fragment.c(),this.h()},l(t){a=i(t,"DIV",{class:!0},!1);var e=c(a);s=i(e,"DIV",{class:!0},!1);var r=c(s);g=i(r,"DIV",{class:!0},!1);var l=c(g);T=i(l,"DIV",{class:!0},!1);var f=c(T);Q.$$.fragment.l(f),I=n(f),_=i(f,"FORM",{},!1);var p=c(_);P=i(p,"FIELDSET",{},!1);var d=c(P);k=i(d,"FIELDSET",{class:!0},!1);var h=c(k);x=i(h,"INPUT",{class:!0,type:!0,placeholder:!0},!1),c(x).forEach(o),h.forEach(o),S=n(d),j=i(d,"FIELDSET",{class:!0},!1);var v=c(j);V=i(v,"INPUT",{class:!0,type:!0,placeholder:!0},!1),c(V).forEach(o),v.forEach(o),U=n(d),A=i(d,"FIELDSET",{class:!0},!1);var m=c(A);O=i(m,"TEXTAREA",{class:!0,rows:!0,placeholder:!0},!1),c(O).forEach(o),m.forEach(o),R=n(d),B=i(d,"FIELDSET",{class:!0},!1);var E=c(B);C=i(E,"INPUT",{class:!0,type:!0,placeholder:!0},!1),c(C).forEach(o),W=n(E),X=i(E,"DIV",{class:!0},!1);var $=c(X);for(let t=0;t<Z.length;t+=1)Z[t].l($);$.forEach(o),E.forEach(o),q=n(d),z=i(d,"BUTTON",{class:!0,type:!0,disabled:!0,status:!0},!1);var y=c(z);G=u(y,"Опубликовать литературу"),y.forEach(o),H=n(d),tt.$$.fragment.l(d),d.forEach(o),p.forEach(o),f.forEach(o),l.forEach(o),r.forEach(o),e.forEach(o),this.h()},h(){f(x,"class","form-control form-control-lg"),f(x,"type","text"),f(x,"placeholder","Название"),f(k,"class","form-group"),f(V,"class","form-control"),f(V,"type","text"),f(V,"placeholder","Краткое описание"),f(j,"class","form-group"),f(O,"class","form-control"),f(O,"rows","8"),f(O,"placeholder","Подробное описание"),f(A,"class","form-group"),f(C,"class","form-control"),f(C,"type","text"),f(C,"placeholder","Теги/жанры"),f(X,"class","tag-list"),f(B,"class","form-group"),f(z,"class","btn btn-lg pull-xs-right btn-primary"),f(z,"type","button"),z.disabled=t.inProgress,f(z,"status","positive"),f(T,"class","col-md-10 offset-md-1 col-xs-12"),f(g,"class","row"),f(s,"class","container page"),f(a,"class","editor-page"),K=[p(x,"input",t.input0_input_handler),p(V,"input",t.input1_input_handler),p(O,"input",t.textarea_input_handler),p(z,"click",t.publish),p(z,"click",t.sendPositive)]},m(e,r){d(e,a,r),h(a,s),h(s,g),h(g,T),v(Q,T,null),h(T,I),h(T,_),h(_,P),h(P,k),h(k,x),m(x,t.article.title),h(P,S),h(P,j),h(j,V),m(V,t.article.description),h(P,U),h(P,A),h(A,O),m(O,t.article.body),h(P,R),h(P,B),h(B,C),M=function(t,a){function s(s){13===s.which&&a(t)}return t.addEventListener("keydown",s),{destroy(){t.removeEventListener("keydown",s)}}}.call(null,C,t.addTag)||{},h(B,W),h(B,X);for(let t=0;t<Z.length;t+=1)Z[t].m(X,null);h(P,q),h(P,z),h(z,G),h(P,H),v(tt,P,null),J=!0},p(t,a){if(t.article&&x.value!==a.article.title&&m(x,a.article.title),t.article&&V.value!==a.article.description&&m(V,a.article.description),t.article&&m(O,a.article.body),t.article){let s;for(Y=a.article.tagList,s=0;s<Y.length;s+=1){const e=F(a,Y,s);Z[s]?Z[s].p(t,e):(Z[s]=N(e),Z[s].c(),Z[s].m(X,null))}for(;s<Z.length;s+=1)Z[s].d(1);Z.length=Y.length}J&&!t.inProgress||(z.disabled=a.inProgress)},i(t){J||(E(Q.$$.fragment,t),E(tt.$$.fragment,t),J=!0)},o(t){$(Q.$$.fragment,t),$(tt.$$.fragment,t),J=!1},d(t){t&&o(a),y(Q),M&&"function"==typeof M.destroy&&M.destroy(),b(Z,t),y(tt),L(K)}}}function j(t,a,s){let e,{article:r,slug:l}=a,i=!1;const{session:c}=T();function o(t){s("article",r.tagList=[...r.tagList.slice(0,t),...r.tagList.slice(t+1)],r)}I(t,c,t=>{s("$session",e=t)});return t.$set=t=>{"article"in t&&s("article",r=t.article),"slug"in t&&s("slug",l=t.slug)},{article:r,slug:l,inProgress:i,errors:void 0,session:c,addTag:function(t){s("article",r.tagList=[...r.tagList,t.value],r),t.value=""},remove:o,publish:async function(){s("inProgress",i=!0);const t=await(l?P(`articles/${l}`,{article:r},e.user&&e.user.token):k("articles",{article:r},e.user&&e.user.token));t.article&&_(`/article/${t.article.slug}`),s("inProgress",i=!1)},sendPositive:()=>x("Успешно!",{status:"positive",icon:"check"}),input0_input_handler:function(){r.title=this.value,s("article",r)},input1_input_handler:function(){r.description=this.value,s("article",r)},textarea_input_handler:function(){r.body=this.value,s("article",r)},click_handler:({i:t})=>o(t)}}class V extends t{constructor(t){super(),a(this,t,j,S,s,["article","slug"])}}export{V as E};
