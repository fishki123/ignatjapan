import{S as t,i as s,s as a,e,b as r,c as l,g as i,h as c,j as o,f as n,k as f,l as u,I as d,o as p,p as h,P as g,m as v,U as m,t as E,a as $,d as y,Q as b,V as L,r as I,v as T,Y as _}from"./client.9ee6942c.js";import{a as P,p as k}from"./api.c8188bb8.js";import{N as x,s as D}from"./Notifications.f4fb9a83.js";import{L as w}from"./ListErrors.fdc70ed2.js";function N(t,s,a){const e=Object.create(t);return e.tag=s[a],e.i=a,e}function S(t){var s,a,v,m,E,$,y=t.tag+"";function b(){return t.click_handler(t)}return{c(){s=e("span"),a=e("i"),v=r(),m=l(y),E=r(),this.h()},l(t){s=i(t,"SPAN",{class:!0},!1);var e=c(s);a=i(e,"I",{class:!0},!1),c(a).forEach(o),v=n(e),m=f(e,y),E=n(e),e.forEach(o),this.h()},h(){u(a,"class","ion-close-round"),u(s,"class","tag-default tag-pill"),$=d(a,"click",b)},m(t,e){p(t,s,e),h(s,a),h(s,v),h(s,m),h(s,E)},p(s,a){t=a,s.article&&y!==(y=t.tag+"")&&g(m,y)},d(t){t&&o(s),$()}}}function j(t){var s,a,g,I,T,_,P,k,D,j,F,V,U,A,O,R,B,M,Q,X,Y,q,z,C,G,H,J,K=new w({props:{errors:t.errors}});let W=t.article.tagList,Z=[];for(let s=0;s<W.length;s+=1)Z[s]=S(N(t,W,s));var tt=new x({});return{c(){s=e("div"),a=e("div"),g=e("div"),I=e("div"),K.$$.fragment.c(),T=r(),_=e("form"),P=e("fieldset"),k=e("fieldset"),D=e("input"),j=r(),F=e("fieldset"),V=e("input"),U=r(),A=e("fieldset"),O=e("textarea"),R=r(),B=e("fieldset"),M=e("input"),X=r(),Y=e("div");for(let t=0;t<Z.length;t+=1)Z[t].c();q=r(),z=e("button"),C=l("Опубликовать литературу"),G=r(),tt.$$.fragment.c(),this.h()},l(t){s=i(t,"DIV",{class:!0},!1);var e=c(s);a=i(e,"DIV",{class:!0},!1);var r=c(a);g=i(r,"DIV",{class:!0},!1);var l=c(g);I=i(l,"DIV",{class:!0},!1);var u=c(I);K.$$.fragment.l(u),T=n(u),_=i(u,"FORM",{},!1);var d=c(_);P=i(d,"FIELDSET",{},!1);var p=c(P);k=i(p,"FIELDSET",{class:!0},!1);var h=c(k);D=i(h,"INPUT",{class:!0,type:!0,placeholder:!0},!1),c(D).forEach(o),h.forEach(o),j=n(p),F=i(p,"FIELDSET",{class:!0},!1);var v=c(F);V=i(v,"INPUT",{class:!0,type:!0,placeholder:!0},!1),c(V).forEach(o),v.forEach(o),U=n(p),A=i(p,"FIELDSET",{class:!0},!1);var m=c(A);O=i(m,"TEXTAREA",{class:!0,rows:!0,placeholder:!0},!1),c(O).forEach(o),m.forEach(o),R=n(p),B=i(p,"FIELDSET",{class:!0},!1);var E=c(B);M=i(E,"INPUT",{class:!0,type:!0,placeholder:!0},!1),c(M).forEach(o),X=n(E),Y=i(E,"DIV",{class:!0},!1);var $=c(Y);for(let t=0;t<Z.length;t+=1)Z[t].l($);$.forEach(o),E.forEach(o),q=n(p),z=i(p,"BUTTON",{class:!0,type:!0,disabled:!0,status:!0},!1);var y=c(z);C=f(y,"Опубликовать литературу"),y.forEach(o),G=n(p),tt.$$.fragment.l(p),p.forEach(o),d.forEach(o),u.forEach(o),l.forEach(o),r.forEach(o),e.forEach(o),this.h()},h(){u(D,"class","form-control form-control-lg"),u(D,"type","text"),u(D,"placeholder","Название"),u(k,"class","form-group"),u(V,"class","form-control"),u(V,"type","text"),u(V,"placeholder","Краткое описание"),u(F,"class","form-group"),u(O,"class","form-control"),u(O,"rows","8"),u(O,"placeholder","Подробное описание"),u(A,"class","form-group"),u(M,"class","form-control"),u(M,"type","text"),u(M,"placeholder","Теги/жанры"),u(Y,"class","tag-list"),u(B,"class","form-group"),u(z,"class","btn btn-lg pull-xs-right btn-primary"),u(z,"type","button"),z.disabled=t.inProgress,u(z,"status","positive"),u(I,"class","col-md-10 offset-md-1 col-xs-12"),u(g,"class","row"),u(a,"class","container page"),u(s,"class","editor-page"),J=[d(D,"input",t.input0_input_handler),d(V,"input",t.input1_input_handler),d(O,"input",t.textarea_input_handler),d(z,"click",t.publish),d(z,"click",t.sendPositive)]},m(e,r){p(e,s,r),h(s,a),h(a,g),h(g,I),v(K,I,null),h(I,T),h(I,_),h(_,P),h(P,k),h(k,D),m(D,t.article.title),h(P,j),h(P,F),h(F,V),m(V,t.article.description),h(P,U),h(P,A),h(A,O),m(O,t.article.body),h(P,R),h(P,B),h(B,M),Q=function(t,s){function a(a){13===a.which&&s(t)}return t.addEventListener("keydown",a),{destroy(){t.removeEventListener("keydown",a)}}}.call(null,M,t.addTag)||{},h(B,X),h(B,Y);for(let t=0;t<Z.length;t+=1)Z[t].m(Y,null);h(P,q),h(P,z),h(z,C),h(P,G),v(tt,P,null),H=!0},p(t,s){if(t.article&&D.value!==s.article.title&&m(D,s.article.title),t.article&&V.value!==s.article.description&&m(V,s.article.description),t.article&&m(O,s.article.body),t.article){let a;for(W=s.article.tagList,a=0;a<W.length;a+=1){const e=N(s,W,a);Z[a]?Z[a].p(t,e):(Z[a]=S(e),Z[a].c(),Z[a].m(Y,null))}for(;a<Z.length;a+=1)Z[a].d(1);Z.length=W.length}H&&!t.inProgress||(z.disabled=s.inProgress)},i(t){H||(E(K.$$.fragment,t),E(tt.$$.fragment,t),H=!0)},o(t){$(K.$$.fragment,t),$(tt.$$.fragment,t),H=!1},d(t){t&&o(s),y(K),Q&&"function"==typeof Q.destroy&&Q.destroy(),b(Z,t),y(tt),L(J)}}}function F(t,s,a){let e,{article:r,slug:l}=s,i=!1;const{session:c}=I();function o(t){a("article",r.tagList=[...r.tagList.slice(0,t),...r.tagList.slice(t+1)],r)}T(t,c,t=>{a("$session",e=t)});return t.$set=t=>{"article"in t&&a("article",r=t.article),"slug"in t&&a("slug",l=t.slug)},{article:r,slug:l,inProgress:i,errors:void 0,session:c,addTag:function(t){a("article",r.tagList=[...r.tagList,t.value],r),t.value=""},remove:o,publish:async function(){a("inProgress",i=!0);const t=await(l?P(`articles/${l}`,{article:r},e.user&&e.user.token):k("articles",{article:r},e.user&&e.user.token));t.article&&_(`/article/${t.article.slug}`),a("inProgress",i=!1)},sendPositive:()=>D("Успешно!",{status:"positive",icon:"check"}),input0_input_handler:function(){r.title=this.value,a("article",r)},input1_input_handler:function(){r.description=this.value,a("article",r)},textarea_input_handler:function(){r.body=this.value,a("article",r)},click_handler:({i:t})=>o(t)}}class V extends t{constructor(t){super(),s(this,t,F,j,a,["article","slug"])}}export{V as E};
